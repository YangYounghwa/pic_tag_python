{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pic-tag</title>
    <link rel="stylesheet" href="{% static 'css/dashboard_style.css' %}">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>
<body>
    
    <!-- 로그인 화면 -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-logo">Pic-tag</div>
            <div class="login-subtitle">실시간 영상 인식 시스템</div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">사용자명</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div class="form-group" id="locationGroup">
                    <label for="location">위치</label>
                    <select id="location" name="location">
                        <option value="">위치를 선택하세요 (관리자는 선택 안함)</option>
                        <option value="entrance">현관 입구</option>
                        <option value="parking">주차장</option>
                        <option value="hallway">복도</option>
                        <option value="emergency">비상구</option>
                    </select>
                </div>
                <button type="submit" class="login-btn">로그인</button>
            </form>
        </div>
    </div>

    <!-- 메인 대시보드 -->
    <div id="dashboardPage" class="dashboard">
        <header class="header">
            <div class="logo">Pic-tag</div>
            <div class="user-info">
                <span>관리자</span>
                <button class="logout-btn" onclick="logout()">로그아웃</button>
            </div>
        </header>

        <div class="main-content">
            <nav class="sidebar">
                <div class="menu-item active" onclick="showSection('monitoring')">실시간 영상감지</div>
                <div class="menu-item" onclick="showSection('detection')">탐색</div>
                <div class="menu-item" onclick="showSection('statistics')">통계 분석</div>
                <div class="menu-item" onclick="showSection('settings')">시스템 설정</div>
            </nav>

            <main class="content-area">
                <!-- 실시간 영상감지 -->
                <div id="monitoring" class="section monitoring-main">
                    <h1 class="page-title">실시간 영상감지</h1>
                    
                    <div class="video-layout">
                        <div class="main-video-area">
                            <div class="main-video">
                                <div class="video-info" id="mainVideoInfo">카메라를 선택하세요</div>
                                <video id="mainCamera" autoplay muted style="width: 100%; height: 100%; object-fit: cover; display: none;"></video>
                                <div id="mainVideoPlaceholder" style="color: white; text-align: center; padding: 20px; font-size: 18px;">
                                    카메라를 선택하세요
                                </div>
                            </div>
                            <div class="video-controls">
                                <button class="control-btn" onclick="playPause()">▶</button>
                                <div class="timeline" onclick="seekVideo(event)">
                                    <div class="timeline-progress"></div>
                                    <div class="timeline-marker"></div>
                                </div>
                                <span id="timeDisplay">14:30:25</span>
                            </div>
                        </div>
                        
                        <div class="camera-grid">
                            <div class="camera-thumb" onclick="selectCamera(this, '현관 입구', 'camera1')">
                                <div class="thumb-video" id="thumb-entrance">연결 대기중</div>
                                <div class="thumb-info">현관 입구</div>
                            </div>
                            <div class="camera-thumb" onclick="selectCamera(this, '주차장', 'camera2')">
                                <div class="thumb-video" id="thumb-parking">연결 대기중</div>
                                <div class="thumb-info">주차장</div>
                            </div>
                            <div class="camera-thumb" onclick="selectCamera(this, '복도', 'hallway')">
                                <div class="thumb-video" id="thumb-hallway">연결 대기중</div>
                                <div class="thumb-info">복도</div>
                            </div>
                            <div class="camera-thumb" onclick="selectCamera(this, '비상구', 'emergency')">
                                <div class="thumb-video" id="thumb-emergency">연결 대기중</div>
                                <div class="thumb-info">비상구</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 탐색 화면 -->
                <div id="detection" class="section hidden">
                    <h1 class="page-title">탐색 (객체 감지)</h1>
                    
                    <div class="detection-layout">
                        <div class="detection-main">
                            <div class="detection-video">
                                <div class="video-info">현관 입구 - CAM01</div>
                                탐색 영상 화면 (모델 탑재 예정)
                            </div>
                            <div class="detection-crops">
                                <div class="crop-title">감지된 인원</div>
                                <div class="crop-grid">
                                    <div class="crop-item" onclick="selectCrop(this, '14:30:15')">
                                        Person 1
                                    </div>
                                    <div class="crop-item" onclick="selectCrop(this, '14:30:22')">
                                        Person 2
                                    </div>
                                    <div class="crop-item" onclick="selectCrop(this, '14:30:28')">
                                        Person 3
                                    </div>
                                    <div class="crop-item" onclick="selectCrop(this, '14:30:35')">
                                        Person 4
                                    </div>
                                    <div class="crop-item" onclick="selectCrop(this, '14:30:41')">
                                        Person 5
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detection-panel">
                            <div class="detection-log">
                                <h3 style="margin-bottom: 15px;">감지 로그</h3>
                                <div class="log-entry">
                                    <div class="log-time">14:30:41</div>
                                    <div class="log-action">인원 감지 - 현관 입구 진입</div>
                                </div>
                                <div class="log-entry">
                                    <div class="log-time">14:30:35</div>
                                    <div class="log-action">인원 감지 - 현관 입구 대기</div>
                                </div>
                                <div class="log-entry">
                                    <div class="log-time">14:30:28</div>
                                    <div class="log-action">인원 감지 - 현관 입구 접근</div>
                                </div>
                                <div class="log-entry">
                                    <div class="log-time">14:30:22</div>
                                    <div class="log-action">인원 감지 - 주차장에서 이동</div>
                                </div>
                                <div class="log-entry">
                                    <div class="log-time">14:30:15</div>
                                    <div class="log-action">인원 감지 - 주차장 진입</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 통계 분석 -->
                <div id="statistics" class="section hidden">
                    <h1 class="page-title">통계 분석</h1>
                    
                    <!-- 주요 지표 카드 -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="todayDetections">142</div>
                            <div class="stat-label">오늘 감지 수</div>
                            <div class="stat-change positive">+12%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="uniquePersons">28</div>
                            <div class="stat-label">고유 인원 수</div>
                            <div class="stat-change negative">-3%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="activeCameras">4</div>
                            <div class="stat-label">활성 카메라</div>
                            <div class="stat-change neutral">0%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgConfidence">94.2%</div>
                            <div class="stat-label">평균 신뢰도</div>
                            <div class="stat-change positive">+2.1%</div>
                        </div>
                    </div>

                    <!-- 차트 섹션 -->
                    <div class="charts-container">
                        <div class="chart-row">
                            <div class="chart-container">
                                <h3 class="chart-title">시간대별 감지 현황</h3>
                                <canvas id="hourlyChart" width="400" height="200"></canvas>
                            </div>
                            <div class="chart-container">
                                <h3 class="chart-title">카메라별 감지 분포</h3>
                                <canvas id="cameraChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="chart-container">
                                <h3 class="chart-title">주간 감지 추이</h3>
                                <canvas id="weeklyChart" width="400" height="200"></canvas>
                            </div>
                            <div class="chart-container">
                                <h3 class="chart-title">신뢰도 분포</h3>
                                <canvas id="confidenceChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- 실시간 로그 테이블 -->
                    <div class="log-section">
                        <h2 class="section-title">실시간 감지 로그</h2>
                        <div class="log-controls">
                            <select id="logFilter" class="log-filter">
                                <option value="all">전체</option>
                                <option value="entrance">현관 입구</option>
                                <option value="parking">주차장</option>
                                <option value="hallway">복도</option>
                                <option value="emergency">비상구</option>
                            </select>
                            <button class="refresh-btn" onclick="refreshLogs()">새로고침</button>
                        </div>
                        <div class="table-container">
                            <table class="log-table" id="identityLogTable">
                                <thead>
                                    <tr>
                                        <th>시간</th>
                                        <th>인원 ID</th>
                                        <th>카메라</th>
                                        <th>위치</th>
                                        <th>신뢰도</th>
                                        <th>상태</th>
                                    </tr>
                                </thead>
                                <tbody id="logTableBody">
                                    <!-- 동적으로 생성될 로그 데이터 -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 인원 추적 현황 -->
                    <div class="tracking-section">
                        <h2 class="section-title">인원 추적 현황</h2>
                        <div class="tracking-grid" id="trackingGrid">
                            <!-- 동적으로 생성될 인원 카드들 -->
                        </div>
                    </div>
                </div>

                <!-- 시스템 설정 -->
                <div id="settings" class="section hidden">
                    <h1 class="page-title">시스템 설정</h1>
                    
                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-title">영상 인식 설정</div>
                        </div>
                        <div class="setting-item">
                            <span>실시간 객체 감지</span>
                            <div class="ios-toggle active" onclick="toggleSetting(this)"></div>
                        </div>
                        <div class="setting-item">
                            <span>인원 추적</span>
                            <div class="ios-toggle active" onclick="toggleSetting(this)"></div>
                        </div>
                        <div class="setting-item">
                            <span>야간 감지 모드</span>
                            <div class="ios-toggle" onclick="toggleSetting(this)"></div>
                        </div>
                        <div class="setting-item">
                            <span>영상 자동 저장</span>
                            <div class="ios-toggle active" onclick="toggleSetting(this)"></div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-title">알림 설정</div>
                        </div>
                        <div class="setting-item">
                            <span>실시간 알림</span>
                            <div class="ios-toggle active" onclick="toggleSetting(this)"></div>
                        </div>
                        <div class="setting-item">
                            <span>이메일 알림</span>
                            <div class="ios-toggle" onclick="toggleSetting(this)"></div>
                        </div>
                        <div class="setting-item">
                            <span>모바일 푸시 알림</span>
                            <div class="ios-toggle active" onclick="toggleSetting(this)"></div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-header">
                            <div class="settings-title">시스템 관리</div>
                        </div>
                        <div class="setting-item">
                            <span>자동 백업</span>
                            <div class="ios-toggle active" onclick="toggleSetting(this)"></div>
                        </div>
                        <div class="setting-item">
                            <span>로그 기록</span>
                            <div class="ios-toggle active" onclick="toggleSetting(this)"></div>
                        </div>
                        <div class="setting-item">
                            <span>성능 모니터링</span>
                            <div class="ios-toggle active" onclick="toggleSetting(this)"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="{% static 'js/dashboard_script.js' %}"></script>
</body>
</html>